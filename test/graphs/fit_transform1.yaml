graphs:

  - id: Broker
    nodes:
    - id: proxy
      module: timeflux.nodes.zmq
      class: Broker
    rate: 0

  - id: Replay
    nodes:
    - id: replay
      module: timeflux.nodes.hdf5
      class: Replay
      params:
        filename: 'test/tmp/data_raw_respiration.hdf5'
        keys:
        - /nexus/signal/raw
        - /calib/events
        timespan: 0.5

    - id: pub_signal
      module: timeflux.nodes.zmq
      class: Pub
      params:
        topic: 'nexus_signal_raw'
    - id: pub_events
      module: timeflux.nodes.zmq
      class: Pub
      params:
        topic: 'calib_events'

    edges:
    - source: replay:eeg_signal_raw
      target: pub_signal
    - source: replay:calib_events
      target: pub_events

  - id: minmax_scaler
    nodes:
    - id: sub
        module: timeflux.nodes.zmq
        class: Sub
        params:
          topics: ["calib_events", "nexus_signal_raw" ]
    - id: fit
      module: timeflux_ml.nodes.fit
      class: Fit
      params:
        event_begins: "accumulation_begins"
        event_ends: "accumulation_ends"
        event_label: "label"
        stack_method: "vstack"
        steps_config:
          - "scaler"
          - "MinMaxScaler"
          - "sklearn.preprocessing"
        fit_params: None
        has_targets: False
        receives_epochs: False
        registry_key: "test_scaler"

    - id: transform
      module: timeflux_ml.nodes.transform
      class: Transform
      params:
        stack_method: "vstack"
        registry_key: "test_scaler"
        set_index: True
        set_columns: True

    - id: display
      module: timeflux.nodes.debug
      class: Display

    edges:
    - source: sub:nexus_signal_raw
      target: fit
    - source: sub:calib_events
      target: fit:events
    - source: sub:nexus_signal_raw
      target: transform
    - source: transform
      target: display
    rate: 10